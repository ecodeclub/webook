// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package search

import (
	"context"
	"sync"

	"github.com/ecodeclub/mq-api"
	"github.com/ecodeclub/webook/internal/cases"
	"github.com/ecodeclub/webook/internal/interactive"
	"github.com/ecodeclub/webook/internal/search/internal/event"
	"github.com/ecodeclub/webook/internal/search/internal/repository"
	"github.com/ecodeclub/webook/internal/search/internal/repository/dao"
	"github.com/ecodeclub/webook/internal/search/internal/service"
	"github.com/ecodeclub/webook/internal/search/internal/web"
	"github.com/ecodeclub/webook/internal/search/ioc"
	"github.com/elastic/go-elasticsearch/v9"
	"github.com/google/wire"
)

// Injectors from wire.go:

func InitModule(es *elasticsearch.TypedClient, q mq.MQ, caModule *cases.Module, intrModule *interactive.Module) (*Module, error) {
	questionDAO := ioc.InitQuestionDAO(es)
	questionRepo := repository.NewQuestionRepo(questionDAO)
	questionSetDAO := ioc.InitQuestionSetDAO(es)
	questionSetRepo := repository.NewQuestionSetRepo(questionSetDAO)
	skillDAO := ioc.InitSkillDAO(es)
	skillRepo := repository.NewSKillRepo(skillDAO)
	caseDAO := ioc.InitCaseDAO(es)
	caseRepo := repository.NewCaseRepo(caseDAO)
	v := service.NewSearchSvc(questionRepo, questionSetRepo, skillRepo, caseRepo)
	v2 := InitSyncSvc(es)
	syncConsumer := initSyncConsumer(v2, q)
	v3 := caModule.ExamineSvc
	v4 := intrModule.Svc
	v5 := web.NewHandler(v, v3, v4)
	v6 := initAdminHandler(es)
	module := &Module{
		SearchSvc:    v,
		SyncSvc:      v2,
		C:            syncConsumer,
		Hdl:          v5,
		AdminHandler: v6,
	}
	return module, nil
}

// wire.go:

func initAdminHandler(es *elasticsearch.TypedClient) *AdminHandler {
	InitIndexOnce(es)
	caDAO := ioc.InitAdminCaseDAO(es)
	questionDAO := ioc.InitAdminQuestionDAO(es)
	questionSetDAO := ioc.InitAdminQuestionSetDAO(es)
	skillDAO := ioc.InitAdminSkillDAO(es)
	caRepo := repository.NewCaseRepo(caDAO)
	questionRepo := repository.NewQuestionRepo(questionDAO)
	questionSetRepo := repository.NewQuestionSetRepo(questionSetDAO)
	skillRepo := repository.NewSKillRepo(skillDAO)
	adminSvc := service.NewSearchSvc(questionRepo, questionSetRepo, skillRepo, caRepo)
	return web.NewAdminHandler(adminSvc)
}

// 初始化c端handler
var HandlerSet = wire.NewSet(ioc.InitCaseDAO, ioc.InitQuestionDAO, ioc.InitQuestionSetDAO, ioc.InitSkillDAO, repository.NewCaseRepo, repository.NewQuestionRepo, repository.NewQuestionSetRepo, repository.NewSKillRepo, service.NewSearchSvc, web.NewHandler)

// 初始化syncSvc
var SyncSvcSet = wire.NewSet(
	InitAnyRepo,
	InitSyncSvc,
)

var daoOnce = sync.Once{}

func InitIndexOnce(es *elasticsearch.TypedClient) {
	daoOnce.Do(func() {
		err := dao.InitES(es)
		if err != nil {
			panic(err)
		}
	})
}

func InitAnyRepo(es *elasticsearch.TypedClient) repository.AnyRepo {
	InitIndexOnce(es)
	anyDAO := dao.NewAnyEsDAO(es)
	anyRepo := repository.NewAnyRepo(anyDAO)
	return anyRepo
}

func InitSyncSvc(es *elasticsearch.TypedClient) service.SyncService {
	anyRepo := InitAnyRepo(es)
	return service.NewSyncSvc(anyRepo)
}

func initSyncConsumer(svc service.SyncService, q mq.MQ) *event.SyncConsumer {
	c, err := event.NewSyncConsumer(svc, q)
	if err != nil {
		panic(err)
	}
	c.Start(context.Background())
	return c
}

type SearchService = service.SearchService

type SyncService = service.SyncService

type Handler = web.Handler

type AdminHandler = web.AdminHandler
